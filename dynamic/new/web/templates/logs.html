<html>
 <head>
  <title>
   Extension Risk Report
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js">
  </script>
 </head>
 <body class="bg-gray-100 font-sans">
  <div class="max-w-6xl mx-auto p-4">
   <div class="mt-6 flex flex-col lg:flex-row">
    <div class="w-full lg:w-1/4 bg-white rounded-lg shadow-lg p-6 mb-6 lg:mb-0">
     <div class="flex flex-col items-center mb-6">
      <div class="text-center text-lg font-bold mb-2">
       CPU
      </div>
      <div class="bg-gray-200 h-64 w-full rounded-lg shadow-inner">
       <canvas height="256" id="chart1" style="display: block; box-sizing: border-box; height: 256px; width: 232px;" width="232">
       </canvas>
      </div>
     </div>
     <div class="flex flex-col items-center">
      <div class="text-center text-lg font-bold mb-2">
       Memory
      </div>
      <div class="bg-gray-200 h-64 w-full rounded-lg shadow-inner">
       <canvas height="256" id="chart2" style="display: block; box-sizing: border-box; height: 256px; width: 232px;" width="232">
       </canvas>
      </div>
     </div>
    </div>
    <div class="w-full lg:w-3/4 lg:ml-6 bg-white rounded-lg shadow-lg p-6">
    <div class="flex items-center justify-between">
        <button class="text-white px-4 py-2 rounded-full ml-auto" style="--tw-bg-opacity: 1; background-color: rgb(99 102 241/var(--tw-bg-opacity));">
            Настроить правила безопасности
        </button>
    </div>
     <h2 class="text-xl font-bold">
      Отчёт
     </h2>
     <p class="text-gray-600">
      Оцените риск использования расширения, используя предоставленную информацию
     </p>
     <div class="mt-4">
      <div class="flex justify-between items-center border-b py-4">
       <div>
        <p class="font-bold">
         Обращение к сетевым ресурсам
        </p>
        <div class="grid grid-cols-2 gap-4 bg-gray-100 p-2 rounded" style="max-height: 400px; overflow-y: auto;">
            <pre class="bg-gray-100 p-2 rounded">{{ log_data }}</pre>
        </div>
       </div>
       <span class="bg-red-100 text-red-500 px-3 py-1 rounded-full">
        HIGH
       </span>
      </div>
      <div class="flex justify-between items-center border-b py-4">
       <div>
        <p class="font-bold">
         Чтение файлов
        </p>
        <div class="grid grid-cols-2 gap-4 bg-gray-100 p-2 rounded">
         <div>
          <p class="text-gray-600">
           Пн	12	Янв	12:00:30	- Read - /path/to/file1.txt
           <br/>
           Вт	13	Янв	12:05:45	- Read - /path/to/file2.txt
           <br/>
           Ср	14	Янв	12:10:15	- Read - /path/to/file3.txt
           <br/>
           Чт	15	Янв	12:15:50	- Read - /path/to/file4.txt
           <br/>
           Пт	16	Янв	12:20:05	- Read - /path/to/file5.txt
          </p>
         </div>
         <div>
          <p class="text-gray-600">
           Accepted
           <br/>
           Blocked
           <br/>
           Accepted
           <br/>
           Blocked
           <br/>
           Accepted
          </p>
         </div>
        </div>
       </div>
       <span class="bg-yellow-100 text-yellow-500 px-3 py-1 rounded-full">
        MED
       </span>
      </div>
      <div class="flex justify-between items-center border-b py-4">
       <div>
        <p class="font-bold">
         Запись файлов
        </p>
        <div class="grid grid-cols-2 gap-4 bg-gray-100 p-2 rounded">
         <div>
          <p class="text-gray-600">
           Пн	12	Янв	12:00:30	- Write - /path/to/file1.txt
           <br/>
           Вт	13	Янв	12:05:45	- Write - /path/to/file2.txt
           <br/>
           Ср	14	Янв	12:10:15	- Write - /path/to/file3.txt
           <br/>
           Чт	15	Янв	12:15:50	- Write - /path/to/file4.txt
           <br/>
           Пт	16	Янв	12:20:05	- Write - /path/to/file5.txt
          </p>
         </div>
         <div>
          <p class="text-gray-600">
           Accepted
           <br/>
           Blocked
           <br/>
           Accepted
           <br/>
           Blocked
           <br/>
           Accepted
          </p>
         </div>
        </div>
       </div>
       <span class="bg-yellow-100 text-yellow-500 px-3 py-1 rounded-full">
        MED
       </span>
      </div>
      <div class="flex justify-between items-center border-b py-4">
       <div>
        <p class="font-bold">
         Создание дочерних процессов
        </p>
        <p class="text-gray-600">
         Расширение не создавало дочерние процессы.
        </p>
       </div>
       <span class="bg-green-100 text-green-500 px-3 py-1 rounded-full">
        LOW
       </span>
      </div>
      <div class="flex justify-between items-center border-b py-4">
       <div>
        <p class="font-bold">
         Выполнение команд
        </p>
        <p class="text-gray-600">
         Никакие команды не выполнились.
        </p>
       </div>
       <span class="bg-green-100 text-green-500 px-3 py-1 rounded-full">
        LOW
       </span>
      </div>
     </div>
     <div class="mt-6 text-center">
      <button class="text-white px-4 py-2 rounded-full" style="--tw-bg-opacity: 1; background-color: rgb(99 102 241/var(--tw-bg-opacity));">
       Посмотреть подробные логи
      </button>
     </div>
    </div>
   </div>
   <a href="/" style="--tw-bg-opacity: 1; background-color: rgb(99 102 241/var(--tw-bg-opacity));" class="absolute top-4 left-4 text-white bg-blue-500 px-4 py-2 rounded">Назад</a>
  </div>
  <script>
        setInterval(() => {
            fetch('/get_chart_data')
                .then(response => response.json())
                .then(data => {
                    const truncatedCpuData = data.cpu.slice(-10); // Get the last 10 data points
                    const truncatedMemoryData = data.memory.slice(-10); // Get the last 10 data points
                    chart1.data.datasets[0].data = truncatedCpuData;
                    chart1.options.scales.y.max = Math.max(...truncatedCpuData) + 10; // Set y-axis max for CPU
                    chart1.update();
                    chart2.data.datasets[0].data = truncatedMemoryData;
                    chart2.options.scales.y.max = Math.max(...truncatedMemoryData) + 10; // Set y-axis max for Memory
                    chart2.update();
                });
        }, 10000); // Update every 10 seconds
        const ctx1 = document.getElementById('chart1').getContext('2d');
        window.onload = function() {
            const logContainer = document.querySelector('.grid.grid-cols-2.gap-4.bg-gray-100.p-2.rounded');
            logContainer.scrollTop = logContainer.scrollHeight; // Scroll to the bottom
            
            let zoomLevel = 1; // Initialize zoom level
            const zoomInButton = document.createElement('button');
            zoomInButton.innerText = '+';
            zoomInButton.onclick = () => {
                zoomLevel += 0.1; // Increase zoom level
                updateChart();
            };
            const zoomOutButton = document.createElement('button');
            zoomOutButton.innerText = '-';
            zoomOutButton.onclick = () => {
                zoomLevel = Math.max(1, zoomLevel - 0.1); // Decrease zoom level, minimum 1
                updateChart();
            };
            document.body.appendChild(zoomInButton);
            document.body.appendChild(zoomOutButton);
        };

        function updateChart() {
            const truncatedCpuData = data.cpu.slice(-10); // Get the last 10 data points
            const truncatedMemoryData = data.memory.slice(-10); // Get the last 10 data points
            chart1.data.datasets[0].data = truncatedCpuData;
            chart1.options.scales.y.max = Math.max(...truncatedCpuData) * zoomLevel + 10; // Adjust y-axis max for CPU
            chart1.update();
            chart2.data.datasets[0].data = truncatedMemoryData;
            chart2.options.scales.y.max = Math.max(...truncatedMemoryData) * zoomLevel + 10; // Adjust y-axis max for Memory
            chart2.update();
        }

        const chart1 = new Chart(ctx1, {
            type: 'line',
            data: {
                labels: Array.from({ length: 9 }, (_, i) => 8 - i),
                datasets: [{
                    label: 'CPU Usage',
                    data: [], // Start with empty data
                    borderColor: '#4CAF50',
                    backgroundColor: 'rgba(76, 175, 80, 0.2)',
                    borderWidth: 1,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Minutes ago'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Value (%)'
                        },
                        beginAtZero: true,
                        max: 15
                    }
                }
            }
        });

        const ctx2 = document.getElementById('chart2').getContext('2d');
        const chart2 = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: Array.from({ length: 9 }, (_, i) => 8 - i),
                datasets: [{
                    label: 'Memory Usage',
                    data: [], // Start with empty data
                    borderColor: '#FF9800',
                    backgroundColor: 'rgba(255, 152, 0, 0.2)',
                    borderWidth: 1,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Minutes ago'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Value (%)'
                        },
                        beginAtZero: true,
                        max: 15
                    }
                }
            }
        });
  </script>
 </body>
</html>
